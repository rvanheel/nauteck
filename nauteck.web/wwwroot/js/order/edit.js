(()=>{"use strict";class e{static FullDateTimeFormat={timeZone:"Europe/Amsterdam",dateStyle:"full",timeStyle:"medium"};static async GetBlobSasUrl(e,t,a){const r=new URL(t,e);r.searchParams.append("extension",a);const o=await fetch(r.href,{cache:"no-cache"});return await o.json()}static GetHtmlInputElement(e){return document.querySelector(e)}static GetHtmlInputElementById(e){return document.getElementById(e)}static GetHtmlSelectElement(e){return document.querySelector(e)}static GetHtmlSelectElementById(e){return document.getElementById(e)}static GetSelectOption(t){const a=e.GetHtmlSelectElementById(t);return a.options[a.selectedIndex]}static RemoveToastr(){toastr.remove()}static SetHtmlTextContent(e,t){document.querySelector(e).textContent=t}static ShowToastr(e="Please wait..",t="LOADING"){toastr.info(e,t,{closeButton:!1,extendedTimeOut:0,hideDuration:10,hideMethod:"slideUp",newestOnTop:!0,positionClass:"toast-top-center",preventDuplicates:!0,showDuration:10,showMethod:"slideDown",tapToDismiss:!1,timeOut:0})}static ToastrError(e,t){toastr.error(t,e,{hideMethod:"slideUp",hideDuration:10,newestOnTop:!0,positionClass:"toast-top-center",preventDuplicates:!0,showDuration:10,showMethod:"slideDown"})}static UploadNewBlob(e,t,a){return fetch(t,{body:a,cache:"no-cache",headers:{"x-ms-content-type":e,"x-ms-blob-type":"BlockBlob","x-ms-version":"2020-10-02"},method:"PUT"})}}const t=e;class a{static NumberFormat=new Intl.NumberFormat("en-US",{style:"decimal",minimumFractionDigits:2,maximumFractionDigits:2});static async AddressCheck(){const e=document.getElementById("form-order").elements,t=e.zipcode,a=t.value.trim(),r=+e.number.value;if(e.address.value="",e.city.value="",e.region.value="",!e.country.value.match(/Nederland/i))return;const o=new URL("/bzk/locatieserver/search/v3_1/free","https://api.pdok.nl");o.searchParams.append("q",`postcode:${a}`),o.searchParams.append("fq",`huisnummer:${r}`),o.searchParams.append("fl","woonplaatsnaam,straatnaam,huisnummer,postcode,provincienaam"),o.searchParams.append("rows","1");const n=await fetch(o.toString(),{method:"GET",cache:"no-cache",redirect:"follow"}),s=await n.json();if(n.ok&&s?.response?.numFound){const a=s.response.docs[0];return e.address.value=a.straatnaam,e.city.value=a.woonplaatsnaam,e.region.value=a.provincienaam,void(t.value=a.postcode)}}static CalculateTotal(){let e=0;document.querySelectorAll("[data-total]").forEach((t=>{e+=parseFloat(t.textContent.replace(",",""))||0}));const r=t.GetHtmlInputElementById("discount"),o=r?+r.value:0,n=a.NumberFormat.format(e-o);t.SetHtmlTextContent('span[data-type="subtotal-price"]',a.NumberFormat.format(e)),t.SetHtmlTextContent('span[data-type="discount-price"]',`- ${a.NumberFormat.format(o)}`),t.SetHtmlTextContent('span[data-type="floor-order-total"]',n),t.GetHtmlInputElementById("Total").value=n}static CallOutCostChanged(){const e=+t.GetHtmlInputElement('[name="parts.CallOutCostPrice"]').value,r=+this.value,o=a.NumberFormat.format(e*r);t.GetHtmlInputElement('[name="parts.CallOutCostTotal"]').value=o,t.SetHtmlTextContent('span[data-type="call-out-cost-price"]',o),a.CalculateTotal()}static ColorChanged(){const e=t.GetSelectOption("Parts.floorColorAbove").dataset.exclusive,r=t.GetSelectOption("Parts.floorColorBeneath").dataset.exclusive;if("true"===e||"true"===r){const e=+t.GetHtmlInputElement('[name="parts.ColorPrice"]').value,r=+t.GetHtmlInputElement('[name="parts.FloorQuantity"]').value,o=t.GetHtmlInputElement('[name="parts.ColorTotal"]');o.value=a.NumberFormat.format(e*r),t.SetHtmlTextContent('span[data-type="color-price"]',o.value)}a.CalculateTotal()}static ConstructionChanged(){const e=+this.options[this.selectedIndex].dataset.price;a.SetPrice("parts.Construction",e),a.CalculateTotal()}static async Delete(){window.location.pathname.split("/").pop(),bootbox.confirm({message:'<div class="alert alert-warning"><p class="fw-bold">Weet u zeker dat u deze order wilt verwijderen?</p><p><strong>LET OP!</strong> dit kan niet ongedaan worden gemaakt en alle gekoppelde items en documenten worden tevens verwijderd.</p></div>',buttons:{confirm:{label:"Ja",className:"btn-danger"},cancel:{label:"Nee",className:"btn-secondary"}},callback:async e=>{if(!e)return;t.ShowToastr();const a=this.dataset.url;if(!(await fetch(a,{method:"DELETE",cache:"no-cache",redirect:"follow"})).ok)return t.RemoveToastr(),void t.ToastrError("Error","Er is een fout opgetreden bij het verwijderen van de order.");window.location.replace("/")}})}static DesignChanged(){const e=+this.options[this.selectedIndex].dataset.price;a.SetPrice("parts.Design",e),a.CalculateTotal()}static FreePriceChanged(){document.querySelector('span[data-type="other-price"]').textContent=a.NumberFormat.format(+this.value),a.CalculateTotal()}static FloorChanged(){const e=this.options[this.selectedIndex],r=+e.dataset.price,o=t.GetHtmlInputElementById("Parts.floorQuantity");var n=a.NumberFormat.format(+o.value*+r);t.GetHtmlInputElement('[name="parts.FloorPrice"]').value=a.NumberFormat.format(r),t.GetHtmlInputElement('[name="parts.FloorTotal"]').value=n,t.SetHtmlTextContent('span[data-type="floor"]',e.textContent),t.SetHtmlTextContent('span[data-type="floor-quantity"]',a.NumberFormat.format(+o.value)),t.SetHtmlTextContent('span[data-type="floor-price"]',a.NumberFormat.format(+r)),t.SetHtmlTextContent('span[data-type="floor-sum"]',n),a.CalculateTotal()}static Initialize(){document.getElementById("country").addEventListener("change",a.AddressCheck,!1),document.getElementById("zipcode").addEventListener("blur",a.AddressCheck,!1),document.getElementById("number").addEventListener("blur",a.AddressCheck,!1),document.querySelectorAll("#button-delete").forEach((e=>e.addEventListener("click",a.Delete,!1))),document.getElementById("Parts.Floor").addEventListener("change",a.FloorChanged,!1),document.querySelectorAll('input[data-type="logo"]').forEach((e=>e.addEventListener("change",a.LogoChanged,!1))),document.querySelectorAll('select[name="parts.FloorColorAbove"],select[name="parts.Parts.floorColorBeneath"]').forEach((e=>e.addEventListener("change",a.ColorChanged,!1))),document.querySelectorAll("#discount").forEach((e=>e.addEventListener("change",a.CalculateTotal,!1))),t.GetHtmlInputElementById("freePrice").addEventListener("change",a.FreePriceChanged,!1),t.GetHtmlInputElementById("Parts.callOutCostQuantity").addEventListener("change",a.CallOutCostChanged,!1),t.GetHtmlInputElementById("Parts.floorQuantity").addEventListener("change",a.QuantityChanged,!1),t.GetHtmlSelectElementById("Parts.design").addEventListener("change",a.DesignChanged,!1),t.GetHtmlSelectElementById("Parts.construction").addEventListener("change",a.ConstructionChanged,!1),t.GetHtmlSelectElementById("Parts.measurement").addEventListener("change",a.MeasurementChanged,!1),a.InitForm(),a.CalculateTotal()}static InitForm(){$("#form-order").validate({messages:{boatBrand:"merk is vereist",boatType:"type is vereist",email:"email is vereist",lastName:"achternaam is vereist",zipcode:"postcode is vereist",number:"huisnummer is vereist",ConstructionBy:"","Parts.construction":"constructie is vereist","Parts.design":"ontwerp is vereist","Parts.measurement":"meting is vereist","Parts.Floor":"vloer is vereist","parts.FloorQuantity":{required:"hoeveelheid is vereist",min:"groter dan 0.0m2"},"Parts.floorColorAbove":"kleur is vereist","Parts.floorColorBeneath":"kleur is vereist"},rules:{boatBrand:"required",boatType:"required",email:"required",lastName:"required",zipcode:"required",number:"required",ConstructionBy:"required","Parts.construction":"required","Parts.design":"required","Parts.measurement":"required","Parts.Floor":"required","parts.FloorQuantity":{required:!0,min:.01},"Parts.floorColorAbove":"required","Parts.floorColorBeneath":"required"},submitHandler(e,a){a.preventDefault();var r=new FormData(e);const o=new URL(e.action,window.location.origin);fetch(o.href,{body:r,method:"POST"}).then((e=>{e.ok?window.location.replace("/"):t.ToastrError("Error","Er is een fout opgetreden bij het opslaan van de order.")}))}})}static LogoChanged(){document.querySelector(`span[data-sum="${this.id}`).textContent=a.NumberFormat.format(+this.value*+this.dataset.price);let e=0;document.querySelectorAll("span[data-sum]").forEach((t=>{e+=parseFloat(t.textContent)||0})),t.GetHtmlInputElement('[name="parts.LogoTotal"]').value=a.NumberFormat.format(e),t.SetHtmlTextContent('[data-type="logo-price"]',a.NumberFormat.format(e)),a.CalculateTotal()}static MeasurementChanged(){const e=+this.options[this.selectedIndex].dataset.price;a.SetPrice("parts.Measurement",e),a.CalculateTotal()}static SetPrice(e,r){const o=a.NumberFormat.format(r);t.GetHtmlInputElement(`[name="${e}Price"]`).value=o,t.GetHtmlInputElement(`[name="${e}Total"]`).value=o}static QuantityChanged(){t.GetHtmlSelectElementById("Parts.Floor").dispatchEvent(new Event("change"))}}document.addEventListener("DOMContentLoaded",a.Initialize)})();