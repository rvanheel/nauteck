(()=>{"use strict";class t{static FullDateTimeFormat={timeZone:"Europe/Amsterdam",dateStyle:"full",timeStyle:"medium"};static async GetBlobSasUrl(t,e,a){const n=new URL(e,t);n.searchParams.append("extension",a);const o=await fetch(n.href,{cache:"no-cache"});return await o.json()}static GetHtmlInputElement(t){return document.querySelector(t)}static GetHtmlInputElementById(t){return document.getElementById(t)}static GetHtmlSelectElement(t){return document.querySelector(t)}static GetHtmlSelectElementById(t){return document.getElementById(t)}static GetSelectOption(e){const a=t.GetHtmlSelectElementById(e);return a.options[a.selectedIndex]}static RemoveToastr(){toastr.remove()}static SetHtmlTextContent(t,e){document.querySelector(t).textContent=e}static ShowToastr(t="Please wait..",e="LOADING"){toastr.info(t,e,{closeButton:!1,extendedTimeOut:0,hideDuration:10,hideMethod:"slideUp",newestOnTop:!0,positionClass:"toast-top-center",preventDuplicates:!0,showDuration:10,showMethod:"slideDown",tapToDismiss:!1,timeOut:0})}static ToastrError(t,e){toastr.error(e,t,{hideMethod:"slideUp",hideDuration:10,newestOnTop:!0,positionClass:"toast-top-center",preventDuplicates:!0,showDuration:10,showMethod:"slideDown"})}static UploadNewBlob(t,e,a){return fetch(e,{body:a,cache:"no-cache",headers:{"x-ms-content-type":t,"x-ms-blob-type":"BlockBlob","x-ms-version":"2020-10-02"},method:"PUT"})}}const e=t;class a{static NumberFormat=new Intl.NumberFormat("en-US",{style:"decimal",minimumFractionDigits:2,maximumFractionDigits:2});static async AddressCheck(){const t=document.getElementById("form-order").elements,e=t.zipcode,a=e.value.trim(),n=+t.number.value;if(t.address.value="",t.city.value="",t.region.value="",!t.country.value.match(/Nederland/i))return;const o=new URL("/bzk/locatieserver/search/v3_1/free","https://api.pdok.nl");o.searchParams.append("q",`postcode:${a}`),o.searchParams.append("fq",`huisnummer:${n}`),o.searchParams.append("fl","woonplaatsnaam,straatnaam,huisnummer,postcode,provincienaam"),o.searchParams.append("rows","1");const r=await fetch(o.toString(),{method:"GET",cache:"no-cache",redirect:"follow"}),l=await r.json();if(r.ok&&l?.response?.numFound){const a=l.response.docs[0];return t.address.value=a.straatnaam,t.city.value=a.woonplaatsnaam,t.region.value=a.provincienaam,void(e.value=a.postcode)}}static CalculateTotal(){let t=0;document.querySelectorAll("[data-total]").forEach((e=>{t+=parseFloat(e.textContent.replace(",",""))||0}));const n=+e.GetHtmlInputElementById("discount").value,o=a.NumberFormat.format(t-n);e.SetHtmlTextContent('span[data-type="subtotal-price"]',a.NumberFormat.format(t)),e.SetHtmlTextContent('span[data-type="discount-price"]',`- ${a.NumberFormat.format(n)}`),e.SetHtmlTextContent('span[data-type="floor-order-total"]',o),e.GetHtmlInputElementById("Total").value=o}static CallOutCostChanged(){const t=+e.GetHtmlInputElement('[name="parts.CallOutCostPrice"]').value,n=+this.value,o=a.NumberFormat.format(t*n);e.GetHtmlInputElement('[name="parts.CallOutCostTotal"]').value=o,e.SetHtmlTextContent('span[data-type="call-out-cost-price"]',o),a.CalculateTotal()}static ColorChanged(){const t=e.GetSelectOption("Parts.floorColorAbove").dataset.exclusive,n=e.GetSelectOption("Parts.floorColorBeneath").dataset.exclusive;if("true"===t||"true"===n){const t=+e.GetHtmlInputElement('[name="parts.ColorPrice"]').value,n=+e.GetHtmlInputElement('[name="parts.FloorQuantity"]').value,o=e.GetHtmlInputElement('[name="parts.ColorTotal"]');o.value=a.NumberFormat.format(t*n),e.SetHtmlTextContent('span[data-type="color-price"]',o.value)}a.CalculateTotal()}static ConstructionChanged(){const t=+this.options[this.selectedIndex].dataset.price;a.SetPrice("parts.Construction",t),a.CalculateTotal()}static async Delete(){window.location.pathname.split("/").pop(),bootbox.confirm({message:'<div class="alert alert-warning"><p class="fw-bold">Weet u zeker dat u deze order wilt verwijderen?</p><p><strong>LET OP!</strong> dit kan niet ongedaan worden gemaakt en alle gekoppelde items en documenten worden tevens verwijderd.</p></div>',buttons:{confirm:{label:"Ja",className:"btn-danger"},cancel:{label:"Nee",className:"btn-secondary"}},callback:async t=>{if(!t)return;e.ShowToastr();const a=this.dataset.url;if(!(await fetch(a,{method:"DELETE",cache:"no-cache",redirect:"follow"})).ok)return e.RemoveToastr(),void e.ToastrError("Error","Er is een fout opgetreden bij het verwijderen van de order.");window.location.replace("/")}})}static DesignChanged(){const t=+this.options[this.selectedIndex].dataset.price;a.SetPrice("parts.Design",t),a.CalculateTotal()}static FreePriceChanged(){document.querySelector('span[data-type="other-price"]').textContent=a.NumberFormat.format(+this.value),a.CalculateTotal()}static FloorChanged(){const t=this.options[this.selectedIndex],n=+t.dataset.price,o=e.GetHtmlInputElementById("Parts.floorQuantity");var r=a.NumberFormat.format(+o.value*+n);e.GetHtmlInputElement('[name="parts.FloorPrice"]').value=a.NumberFormat.format(n),e.GetHtmlInputElement('[name="parts.FloorTotal"]').value=r,e.SetHtmlTextContent('span[data-type="floor"]',t.textContent),e.SetHtmlTextContent('span[data-type="floor-quantity"]',a.NumberFormat.format(+o.value)),e.SetHtmlTextContent('span[data-type="floor-price"]',a.NumberFormat.format(+n)),e.SetHtmlTextContent('span[data-type="floor-sum"]',r),a.CalculateTotal()}static Initialize(){document.getElementById("country").addEventListener("change",a.AddressCheck,!1),document.getElementById("zipcode").addEventListener("blur",a.AddressCheck,!1),document.getElementById("number").addEventListener("blur",a.AddressCheck,!1),document.getElementById("button-delete").addEventListener("click",a.Delete,!1),document.getElementById("Parts.Floor").addEventListener("change",a.FloorChanged,!1),document.querySelectorAll('input[data-type="logo"]').forEach((t=>t.addEventListener("change",a.LogoChanged,!1))),document.querySelectorAll('select[name="parts.FloorColorAbove"],select[name="parts.Parts.floorColorBeneath"]').forEach((t=>t.addEventListener("change",a.ColorChanged,!1))),e.GetHtmlInputElementById("discount").addEventListener("change",a.CalculateTotal,!1),e.GetHtmlInputElementById("freePrice").addEventListener("change",a.FreePriceChanged,!1),e.GetHtmlInputElementById("Parts.callOutCostQuantity").addEventListener("change",a.CallOutCostChanged,!1),e.GetHtmlInputElementById("Parts.floorQuantity").addEventListener("change",a.QuantityChanged,!1),e.GetHtmlSelectElementById("Parts.design").addEventListener("change",a.DesignChanged,!1),e.GetHtmlSelectElementById("Parts.construction").addEventListener("change",a.ConstructionChanged,!1),e.GetHtmlSelectElementById("Parts.measurement").addEventListener("change",a.MeasurementChanged,!1),a.InitForm()}static InitForm(){$("#form-order").validate({messages:{},rules:{},submitHandler(t,a){a.preventDefault();var n=new FormData(t);const o=new URL(t.action,window.location.origin);fetch(o.href,{body:n,method:"POST"}).then((t=>{t.ok?window.location.replace("/"):e.ToastrError("Error","Er is een fout opgetreden bij het opslaan van de order.")}))}})}static LogoChanged(){document.querySelector(`span[data-sum="${this.id}`).textContent=a.NumberFormat.format(+this.value*+this.dataset.price);let t=0;document.querySelectorAll("span[data-sum]").forEach((e=>{t+=parseFloat(e.textContent)||0})),e.GetHtmlInputElement('[name="parts.LogoTotal"]').value=a.NumberFormat.format(t),e.SetHtmlTextContent('[data-type="logo-price"]',a.NumberFormat.format(t)),a.CalculateTotal()}static MeasurementChanged(){const t=+this.options[this.selectedIndex].dataset.price;a.SetPrice("parts.Measurement",t),a.CalculateTotal()}static SetPrice(t,n){const o=a.NumberFormat.format(n);e.GetHtmlInputElement(`[name="${t}Price"]`).value=o,e.GetHtmlInputElement(`[name="${t}Total"]`).value=o}static QuantityChanged(){e.GetHtmlSelectElementById("Parts.Floor").dispatchEvent(new Event("change"))}}document.addEventListener("DOMContentLoaded",a.Initialize)})();