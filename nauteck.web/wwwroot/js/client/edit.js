(()=>{"use strict";class e{static FullDateTimeFormat={timeZone:"Europe/Amsterdam",dateStyle:"full",timeStyle:"medium"};static Delete(t,a,r,o,n){bootbox.confirm({message:`<div class="alert alert-warning"><p class="fw-bold">${a}</p><p><strong>LET OP!</strong> ${r}.</p></div>`,buttons:{confirm:{label:"Ja",className:"btn-danger"},cancel:{label:"Nee",className:"btn-secondary"}},callback:async a=>{if(!a)return;e.ShowToastr();const r=t.dataset.url;if(!(await fetch(r,{method:"DELETE",cache:"no-cache",redirect:"follow"})).ok)return e.RemoveToastr(),void e.ToastrError("Error",o);window.location.replace(n)}})}static async GetBlobSasUrl(e,t,a){const r=new URL(t,e);r.searchParams.append("extension",a);const o=await fetch(r.href,{cache:"no-cache"});return await o.json()}static GetHtmlInputElement(e){return document.querySelector(e)}static GetHtmlInputElementById(e){return document.getElementById(e)}static GetHtmlSelectElement(e){return document.querySelector(e)}static GetHtmlSelectElementById(e){return document.getElementById(e)}static GetSelectOption(t){const a=e.GetHtmlSelectElementById(t);return a.options[a.selectedIndex]}static RemoveToastr(){toastr.clear()}static SetHtmlTextContent(e,t){document.querySelector(e).textContent=t}static ShowToastr(e="Please wait..",t="LOADING"){toastr.info(e,t,{closeButton:!1,extendedTimeOut:0,hideDuration:10,hideMethod:"slideUp",newestOnTop:!0,positionClass:"toast-top-center",preventDuplicates:!0,showDuration:10,showMethod:"slideDown",tapToDismiss:!1,timeOut:0})}static ToastrError(e,t){toastr.error(t,e,{hideMethod:"slideUp",hideDuration:10,newestOnTop:!0,positionClass:"toast-top-center",preventDuplicates:!0,showDuration:10,showMethod:"slideDown"})}static UploadNewBlob(e,t,a){return fetch(t,{body:a,cache:"no-cache",headers:{"x-ms-content-type":e,"x-ms-blob-type":"BlockBlob","x-ms-version":"2020-10-02"},method:"PUT"})}}const t=e;class a{static abortController=null;static async AddressCheck(){a.abortController&&(a.abortController.abort(),console.error("aborting previous request")),a.abortController=new AbortController;const e=a.abortController.signal,r=document.getElementById("form-client").elements,o=r.Zipcode,n=o.value.trim(),s=+r.Number.value,i=r.Address,l=r.City,c=r.Region;i.value="",l.value="",c.value="";const d=t.GetHtmlInputElementById("Address"),m=t.GetHtmlInputElementById("City"),u=t.GetHtmlInputElementById("Region");if(d.setAttribute("readonly","readonly"),m.setAttribute("readonly","readonly"),u.setAttribute("readonly","readonly"),!r.Country.value.match(/Nederland/i))return d.removeAttribute("readonly"),m.removeAttribute("readonly"),void u.removeAttribute("readonly");const h=new URL("/bzk/locatieserver/search/v3_1/free","https://api.pdok.nl");h.searchParams.append("q",`postcode:${n}`),h.searchParams.append("fq",`huisnummer:${s}`),h.searchParams.append("fl","woonplaatsnaam,straatnaam,huisnummer,postcode,provincienaam"),h.searchParams.append("rows","1");const p=await fetch(h.toString(),{method:"GET",cache:"no-cache",redirect:"follow",signal:e}),b=await p.json();if(p.ok&&b?.response?.numFound){const e=b.response.docs[0];return i.value=e.straatnaam,l.value=e.woonplaatsnaam,c.value=e.provincienaam,void(o.value=e.postcode)}a.abortController=null}static async DeleteAttachment(){bootbox.confirm({message:'<div class="alert alert-warning"><p class="fw-bold">Weet u zeker dat u deze bijlage wilt verwijderen?</p><p><strong>LET OP!</strong> dit kan niet ongedaan worden gemaakt.</p></div>',buttons:{confirm:{label:"Ja",className:"btn-danger"},cancel:{label:"Nee",className:"btn-secondary"}},callback:async e=>{if(!e)return;t.ShowToastr();const a=this.dataset.url;if(!(await fetch(a,{method:"DELETE",cache:"no-cache",redirect:"follow"})).ok)return t.RemoveToastr(),void t.ToastrError("Error","Er is een fout opgetreden bij het verwijderen van de klant.");window.location.reload()}})}static Initialize(){document.getElementById("Country").addEventListener("change",a.AddressCheck,!1),document.getElementById("Zipcode").addEventListener("blur",a.AddressCheck,!1),document.getElementById("Number").addEventListener("blur",a.AddressCheck,!1),a.InitForm(),a.InitAttachmentTable(),document.querySelectorAll("button.btn-danger").forEach((e=>e.addEventListener("click",a.DeleteAttachment)))}static InitForm(){$("#form-client").validate({messages:{BoatBrand:"Merk is vereist",BoatType:"Type is vereist",Email:"Email is vereist",LastName:"Achternaam is vereist",Address:"Adres is vereist",City:"Plaats is vereist",Region:"Provincie is vereist",Zipcode:"Postcode is vereist",Number:"Huisnummer is vereist"},rules:{BoatBrand:"required",BoatType:"required",Email:"required",LastName:"required",Address:"required",City:"required",Region:"required",Zipcode:"required",Number:"required"},submitHandler:async function(e,a){a.preventDefault(),t.ShowToastr();var r=new FormData(e);const o=new URL(e.action,window.location.origin);if(!(await fetch(o.href,{body:r,method:"POST"})).ok)return t.RemoveToastr(),void t.ToastrError("Error","Er is een fout opgetreden bij het opslaan van de order.");window.location.href="/"}})}static InitAttachmentTable(){$("#table-attachments").DataTable({autoWidth:!1,columnDefs:[{targets:[0,5],className:"text-center",orderable:!1,searchable:!1,width:"2rem"}],language:{url:"https://cdn.datatables.net/plug-ins/1.10.25/i18n/Dutch.json"},order:[[1,"asc"]],paging:!1})}}document.addEventListener("DOMContentLoaded",a.Initialize)})();