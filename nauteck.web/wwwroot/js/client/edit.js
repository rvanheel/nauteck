(()=>{"use strict";class e{static FullDateTimeFormat={timeZone:"Europe/Amsterdam",dateStyle:"full",timeStyle:"medium"};static async GetBlobSasUrl(e,t,r){const a=new URL(t,e);a.searchParams.append("extension",r);const o=await fetch(a.href,{cache:"no-cache"});return await o.json()}static GetHtmlInputElement(e){return document.querySelector(e)}static GetHtmlInputElementById(e){return document.getElementById(e)}static GetHtmlSelectElement(e){return document.querySelector(e)}static GetHtmlSelectElementById(e){return document.getElementById(e)}static GetSelectOption(t){const r=e.GetHtmlSelectElementById(t);return r.options[r.selectedIndex]}static RemoveToastr(){toastr.remove()}static SetHtmlTextContent(e,t){document.querySelector(e).textContent=t}static ShowToastr(e="Please wait..",t="LOADING"){toastr.info(e,t,{closeButton:!1,extendedTimeOut:0,hideDuration:10,hideMethod:"slideUp",newestOnTop:!0,positionClass:"toast-top-center",preventDuplicates:!0,showDuration:10,showMethod:"slideDown",tapToDismiss:!1,timeOut:0})}static ToastrError(e,t){toastr.error(t,e,{hideMethod:"slideUp",hideDuration:10,newestOnTop:!0,positionClass:"toast-top-center",preventDuplicates:!0,showDuration:10,showMethod:"slideDown"})}static UploadNewBlob(e,t,r){return fetch(t,{body:r,cache:"no-cache",headers:{"x-ms-content-type":e,"x-ms-blob-type":"BlockBlob","x-ms-version":"2020-10-02"},method:"PUT"})}}const t=e;class r{static abortController=null;static async AddressCheck(){r.abortController&&(r.abortController.abort(),console.error("aborting previous request")),r.abortController=new AbortController;const e=r.abortController.signal,a=document.getElementById("form-client").elements,o=a.Zipcode,n=o.value.trim(),s=+a.Number.value,i=a.Address,l=a.City,d=a.Region;i.value="",l.value="",d.value="";const c=t.GetHtmlInputElementById("Address"),m=t.GetHtmlInputElementById("City"),u=t.GetHtmlInputElementById("Region");if(c.setAttribute("readonly","readonly"),m.setAttribute("readonly","readonly"),u.setAttribute("readonly","readonly"),!a.Country.value.match(/Nederland/i))return c.removeAttribute("readonly"),m.removeAttribute("readonly"),void u.removeAttribute("readonly");const h=new URL("/bzk/locatieserver/search/v3_1/free","https://api.pdok.nl");h.searchParams.append("q",`postcode:${n}`),h.searchParams.append("fq",`huisnummer:${s}`),h.searchParams.append("fl","woonplaatsnaam,straatnaam,huisnummer,postcode,provincienaam"),h.searchParams.append("rows","1");const p=await fetch(h.toString(),{method:"GET",cache:"no-cache",redirect:"follow",signal:e}),v=await p.json();if(p.ok&&v?.response?.numFound){const e=v.response.docs[0];return i.value=e.straatnaam,l.value=e.woonplaatsnaam,d.value=e.provincienaam,void(o.value=e.postcode)}r.abortController=null}static async DeleteAttachment(){bootbox.confirm({message:'<div class="alert alert-warning"><p class="fw-bold">Weet u zeker dat u deze bijlage wilt verwijderen?</p><p><strong>LET OP!</strong> dit kan niet ongedaan worden gemaakt.</p></div>',buttons:{confirm:{label:"Ja",className:"btn-danger"},cancel:{label:"Nee",className:"btn-secondary"}},callback:async e=>{if(!e)return;t.ShowToastr();const r=this.dataset.url;if(!(await fetch(r,{method:"DELETE",cache:"no-cache",redirect:"follow"})).ok)return t.RemoveToastr(),void t.ToastrError("Error","Er is een fout opgetreden bij het verwijderen van de klant.");window.location.reload()}})}static Initialize(){document.getElementById("Country").addEventListener("change",r.AddressCheck,!1),document.getElementById("Zipcode").addEventListener("blur",r.AddressCheck,!1),document.getElementById("Number").addEventListener("blur",r.AddressCheck,!1),r.InitForm(),r.InitAttachmentTable(),document.querySelectorAll("button.btn-danger").forEach((e=>e.addEventListener("click",r.DeleteAttachment)))}static InitForm(){$("#form-client").validate({messages:{BoatBrand:"Merk is vereist",BoatType:"Type is vereist",Email:"Email is vereist",LastName:"Achternaam is vereist",Address:"Adres is vereist",City:"Plaats is vereist",Region:"Provincie is vereist",Zipcode:"Postcode is vereist",Number:"Huisnummer is vereist"},rules:{BoatBrand:"required",BoatType:"required",Email:"required",LastName:"required",Address:"required",City:"required",Region:"required",Zipcode:"required",Number:"required"},submitHandler:async function(e,r){r.preventDefault(),t.ShowToastr();var a=new FormData(e);const o=new URL(e.action,window.location.origin);if(!(await fetch(o.href,{body:a,method:"POST"})).ok)return t.RemoveToastr(),void t.ToastrError("Error","Er is een fout opgetreden bij het opslaan van de order.");window.location.href="/"}})}static InitAttachmentTable(){$("#table-attachments").DataTable({autoWidth:!1,columnDefs:[{targets:[0,5],className:"text-center",orderable:!1,searchable:!1,width:"2rem"}],language:{url:"https://cdn.datatables.net/plug-ins/1.10.25/i18n/Dutch.json"},order:[[1,"asc"]],paging:!1})}}document.addEventListener("DOMContentLoaded",r.Initialize)})();